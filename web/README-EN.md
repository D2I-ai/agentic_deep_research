# 🚀 Web Frontend Startup Script and Usage Guide

A Python script that automatically checks for and installs Node.js, installs dependencies, frees up a port, and launches the **Vite development server** with a single command.

Compatible with:

  - **Linux** (supports automatic Node.js installation)
  - **macOS** (works if Node.js is already installed)
  - **Windows** (works if Node.js is already installed)

-----

## ✨ Features

1.  **Automatic Node.js Installation (Linux)**
      - Prioritizes **nvm** (without `sudo`) to install to `~/.nvm`.
      - If necessary, it tries system package managers (`apt` / `yum`).
2.  **Automatic PATH Fix**
      - Ensures Node and `npm` are callable by the Python subprocess.
3.  **Automatic `npm` Dependency Installation**
      - Only runs when `package.json` changes or on the first run.
4.  **Port Release Before Launch**
      - Checks for port usage and kills the corresponding process (`lsof` / `fuser`).
5.  **Vite Development Server Launch**
6.  **Safe Exit with Ctrl+C**
      - Kills the entire process group, ensuring the port is released immediately.

-----

## 📦 Requirements

  - Python **3.5+**
  - Node.js **\>=16.20.0**
      - LTS version is recommended ([Node Download](https://nodejs.org/en/download/)).
  - `npm` **\>=8**
  - System Tools:
      - `curl` (for Node.js installation)
      - `lsof` or `fuser` (for port release)
      - `git` (for installing packages from source)

**Check Your Versions**

```bash
node -v
npm -v
python --version
```

## ⚡ Quick Start

```bash
git clone <your-repo-url>
cd your-repo/web
python run.py
```

Upon launching, the script will automatically:

  - Check for Node.js
  - Install dependencies
  - Start the Vite Dev Server

| Platform    | Auto Node.js Install | Auto PATH Fix | Auto Port Release | Notes |
|-------------|----------------------|---------------|-------------------|-------|
| Linux       | ✅ Supported (nvm without sudo / apt / yum) | ✅ | ✅ | Recommended platform |
| macOS       | ❌ (requires manual Node.js installation) | ✅ | ✅ | Works normally after manual install |
| Windows     | ❌ (requires manual Node.js installation) | ❌ | ✅ | |

## 🔧 Script Usage

  - **1. Modify Backend Service URL and Frontend Port**

      - Edit `.env.development` to change the backend service address.
      - Edit `vite.config.ts`'s `server.port` to change the frontend service port.

  - **2. Default Launch**

      - Launches on port 8080 or automatically finds a free port.

    <!-- end list -->

    ```bash
    python run.py
    ```

  - **3. Specify a Port**

      - The script will increment the port number until an available one is found.

    <!-- end list -->

    ```bash
    python run.py --port 8080
    ```

  - **4. Specify Port + Strict Mode**

      - Exits with an error if the specified port is in use.

    <!-- end list -->

    ```bash
    python run.py --port 8080 --strict
    ```

  - **5. Debug Mode**

    ```bash
    python run.py --debug
    ```

## ⚙️ Script Workflow Diagram

The script performs the following steps:

1.  **Detect and Install Node.js**
      - Prioritizes **nvm (without `sudo`)** to install to `$HOME/.nvm` to avoid permission errors.
      - If necessary, it tries system package managers (`apt`/`yum`).
2.  **Automatic PATH Fix**
      - After installation or if it detects an nvm-installed Node, it automatically adds it to the global PATH.
3.  **Install `@rollup/rollup-linux-x64-gnu`** (Linux x86\_64 only)
4.  **Automatically Check and Install `npm` Dependencies**
5.  **Release Port Before Launch**
      - Checks for the specified port's usage (`lsof`). If occupied, it kills the occupying process.
6.  **Launch the Vite Development Server**
7.  **Complete Exit with Ctrl+C**
      - Terminates the entire process group to ensure the port is released immediately.

## 📄 Project Structure

```bash
project/
│
├── run.py                   # Python startup script (auto-detects/installs Node, deps, frees port, and starts frontend)
├── package.json             # Frontend dependencies and npm script configuration
├── vite.config.ts           # Vite build tool configuration file
├── package-lock.json        # Dependency version lock file (auto-generated by npm)
├── public/                  # Public static assets (copied as-is to the build output directory)
├── src/                     # Frontend project source code
│   ├── api/                 # API configurations and request wrappers
│   ├── components/          # Common components (reusable UI components)
│   ├── hooks/               # Custom Hooks (React)
│   ├── locales/             # Internationalization language files
│   ├── redux/               # Redux state management files
│   ├── router/              # Router configuration and page navigation
│   ├── styles/              # Global common styles (CSS/SCSS)
│   ├── utils/               # Utility functions and common methods
│   ├── views/               # Page components (divided by functional modules)
│   ├── App.tsx              # React root component
│   ├── main.tsx             # Project entry file, mounts the React app
│   ├── index.html           # HTML template file (Vite injects scripts into this template)
│   ├── .env.development     # Development environment variables (e.g., API request address)
│   ├── .env.production      # Production environment variables
└── README.md                # Project documentation
```

## 🔧 Common Developer Configurations

Before developing or deploying, you can modify the following files as needed:

  - **Modify Backend API Address**

      - **Development:** Edit `.env.development`
        Example:

    <!-- end list -->

    ```env
    VITE_PROXY_TARGET=http://localhost:8080   # Your development backend address
    ```

      - **Production:** Edit `.env.production`
        Example:

    <!-- end list -->

    ```env
    VITE_API_BASE_URL=https://api.example.com
    ```

  - **Modify Frontend Startup Port**

      - Edit `server.port` in `vite.config.ts`.
        Example:

    <!-- end list -->

    ```ts
    export default defineConfig({
      server: {
        port: 8080,        // Modify port here
        host: "0.0.0.0"
      }
    });
    ```

> 💡 Tip: Changes to environment variable (`.env.*`) files require a service restart to take effect.

-----

## 🛠 Linux Manual Node.js Installation (Alternative)

If the automatic installation fails, you can manually install Node.js (≥16 LTS):

### Option 1: NodeSource Official Script

```bash
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs  # or apt install
```

### Option 2: `nvm` Installation

```bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.5/install.sh | bash
source ~/.bashrc
nvm install 16
nvm use 16
nvm alias default 16
```

## 🚀 Use Existing Node Directly (Skip `run.py`)

```bash
npm install
npm install @rollup/rollup-linux-x64-gnu   # Required for Linux x86_64
npm run dev
```

## ❗ Common Problems

Q: `node: command not found` error on startup.
A:

  - Linux: Run `python3 run.py` directly to automatically install Node.js.
  - macOS/Windows: Manually install from the official Node.js website.

Q: Port is occupied on startup.
A: The script automatically uses `lsof`/`fuser` to release the port. If your system doesn't have these commands, please install them:

```bash
sudo apt-get install -y lsof    # Debian/Ubuntu
sudo yum install -y lsof        # CentOS/RHEL
```

Q: How to switch Node versions (`nvm`)?

```bash
nvm install 16
nvm use 16
nvm alias default 16
```